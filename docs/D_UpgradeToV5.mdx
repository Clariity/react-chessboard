import { Meta } from '@storybook/blocks';

<Meta title="Upgrade Guides/Upgrading to V5" />

# Upgrading to V5

This guide will help you upgrade your react-chessboard implementation from v4 to v5. The new version is a ground up rewrite that includes several breaking changes and new features that you'll need to be aware of.

## Breaking Changes

### React Version Requirement

- Minimum `react` version is now `19.0.0`
- Update your `react` and `react-dom` dependencies:

  ```bash
  pnpm add react@^19.0.0 react-dom@^19.0.0
  # or
  yarn add react@^19.0.0 react-dom@^19.0.0
  # or
  npm install react@^19.0.0 react-dom@^19.0.0
  ```

### Node.js Requirement

- Minimum `node` version is now `20.11.0`

## API Changes

The v5 release includes significant changes to the API. Here's a detailed comparison of the changes:

### Props Renamed/Removed

| v4 Prop                         | v5 Change                                                                                                      | Notes                                                              |
| ------------------------------- | -------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------ |
| `allowDragOutsideBoard`         | Renamed to `allowDragOffBoard`                                                                                 | Same functionality, new name                                       |
| `animationDuration`             | Renamed to `animationDurationInMs`                                                                             | Same functionality, more explicit name                             |
| `areArrowsAllowed`              | Removed                                                                                                        | Drawing arrows is not currently supported in v5                    |
| `arePremovesAllowed`            | Removed                                                                                                        | Premove functionality has been removed                             |
| `arePiecesDraggable`            | Renamed to `allowDragging`                                                                                     | Same functionality, new name                                       |
| `autoPromoteToQueen`            | Removed                                                                                                        | Promotion logic has been removed from internal functionality       |
| `boardWidth`                    | Removed                                                                                                        | Use CSS to control board dimensions                                |
| `clearPremovesOnRightClick`     | Removed                                                                                                        | Premove functionality has been removed from internal functionality |
| `customArrowColor`              | Removed                                                                                                        | Drawing arrows is not currently supported in v5                    |
| `customArrows`                  | Removed                                                                                                        | Drawing arrows is not currently supported in v5                    |
| `customBoardStyle`              | Renamed to `boardStyle`                                                                                        | Same functionality, simplified name                                |
| `customDarkSquareStyle`         | Renamed to `darkSquareStyle`                                                                                   | Same functionality, simplified name                                |
| `customDndBackend`              | Removed                                                                                                        | No longer required with move to @dnd-kit/core                      |
| `customDndBackendOptions`       | Removed                                                                                                        | No longer required with move to @dnd-kit/core                      |
| `customDropSquareStyle`         | Renamed to `dropSquareStyle`                                                                                   | Same functionality, simplified name                                |
| `customLightSquareStyle`        | Renamed to `lightSquareStyle`                                                                                  | Same functionality, simplified name                                |
| `customNotationStyle`           | Split into `alphaNotationStyle`, `numericNotationStyle`, `darkSquareNotationStyle`, `lightSquareNotationStyle` | More granular control over notation styling                        |
| `customPieces`                  | Renamed to `pieces`                                                                                            | Same functionality, simplified name                                |
| `customPremoveDarkSquareStyle`  | Removed                                                                                                        | Premove functionality has been removed from internal functionality |
| `customPremoveLightSquareStyle` | Removed                                                                                                        | Premove functionality has been removed from internal functionality |
| `customSquare`                  | Removed                                                                                                        | Custom square rendering is not currently supported in v5           |
| `customSquareStyles`            | Renamed to `squareStyle`                                                                                       | Same functionality, simplified name                                |
| `getPositionObject`             | Removed                                                                                                        | Removed until desired use case arises                              |
| `id`                            | Removed                                                                                                        | No longer required                                                 |
| `isDraggablePiece`              | Removed                                                                                                        | Individual piece drag toggling is not currently supported in v5    |
| `onArrowsChange`                | Removed                                                                                                        | Drawing arrows is not currently supported in v5                    |
| `onDragOverSquare`              | Removed                                                                                                        | Removed until desired use case arises                              |
| `onPieceDragBegin`              | Renamed to `onPieceDragStart`                                                                                  | Same functionality, new name                                       |
| `onPieceDragEnd`                | Removed                                                                                                        | Redundant, can use onPieceDrop instead                             |
| `onPromotionCheck`              | Removed                                                                                                        | Promotion handling has been removed from internal functionality    |
| `onPromotionPieceSelect`        | Removed                                                                                                        | Promotion handling has been removed from internal functionality    |
| `promotionDialogVariant`        | Removed                                                                                                        | Promotion handling has been removed from internal functionality    |
| `promotionToSquare`             | Removed                                                                                                        | Promotion handling has been removed from internal functionality    |
| `showBoardNotation`             | Renamed to `showNotation`                                                                                      | Same functionality, simplified name                                |
| `showPromotionDialog`           | Removed                                                                                                        | Promotion handling has been removed from internal functionality    |
| `snapToCursor`                  | Removed                                                                                                        | Piece snapping is now default                                      |

### Unchanged Props

| v4 Prop              | Default Value                                   | Description                                                                        |
| -------------------- | ----------------------------------------------- | ---------------------------------------------------------------------------------- |
| `boardOrientation`   | `'white'`                                       | The orientation of the board, the chosen colour will be at the bottom of the board |
| `onMouseOutSquare`   | `undefined`                                     | User function that is run when mouse leaves a square                               |
| `onMouseOverSquare`  | `undefined`                                     | User function that is run when mouse is over a square                              |
| `onPieceClick`       | `undefined`                                     | User function that is run when piece is clicked                                    |
| `onSquareClick`      | `undefined`                                     | User function that is run when a square is clicked                                 |
| `onSquareRightClick` | `undefined`                                     | User function that is run when a square is right clicked                           |
| `position`           | `'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR'` | FEN string or position object notating where the chess pieces are on the board     |

### Handler Argument Type Changes

The following handlers now receive more consistent argument types with additional properties:

| Handler              | v4 Arguments                          | v5 Arguments                                                                                                                      | Changes                                             |
| -------------------- | ------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------- |
| `onPieceClick`       | `(piece, square)`                     | `({ piece: { pieceType: string }, square: string })`                                                                              | Now receives an object with structured piece data   |
| `onPieceDragStart`   | `(piece, sourceSquare)`               | `({ isSparePiece: boolean, piece: { pieceType: string }, square: string \| null })`                                               | Added `isSparePiece` flag and structured piece data |
| `onPieceDrop`        | `(sourceSquare, targetSquare, piece)` | `({ piece: { isSparePiece: boolean, pieceType: string, position: string }, sourceSquare: string, targetSquare: string \| null })` | Added `isSparePiece` flag and structured piece data |
| `onSquareClick`      | `(square, piece)`                     | `({ piece: string \| null, square: string })`                                                                                     | Now receives an object with consistent structure    |
| `onSquareRightClick` | `(square)`                            | `({ piece: string \| null, square: string })`                                                                                     | Added piece information to the arguments            |

### New Features

- `chessboardRows` and `chessboardColumns`: Control board dimensions
- `draggingPieceStyle`: Style the piece while being dragged
- Improved TypeScript support with better type definitions
- Better mobile and touch device support
- Enhanced animation system

## Migration Steps

1. Update Dependencies

   ```bash
   npm install react-chessboard@latest
   # or
   yarn add react-chessboard@latest
   # or
   pnpm add react-chessboard@latest
   ```

2. Update React Version

   ```bash
   pnpm add react@^19.0.0 react-dom@^19.0.0
   # or
   yarn add react@^19.0.0 react-dom@^19.0.0
   # or
   npm install react@^19.0.0 react-dom@^19.0.0
   ```

3. Review Your Implementation

   - Update prop names to match new API
   - Remove any usage of removed features
   - Update event handlers to use new names
   - Review styling implementation to use new style props

4. Update TypeScript Configurations
   - Ensure your tsconfig.json is compatible with React 19
   - Update any custom type definitions to match the new types

## Common Issues and Solutions

### Drag and Drop Issues

If you experience issues with drag and drop functionality:

- Check that you're using the latest version of @dnd-kit/core
- Review the `allowDragOffBoard` option if pieces are being dragged off the board unexpectedly
- Ensure touch events are working correctly on mobile devices

### Animation Problems

If animations aren't working as expected:

- Verify the `showAnimations` option is set correctly
- Adjust `animationDurationInMs` if animations are too fast or slow
- Check for any CSS conflicts that might affect animations

### Styling Conflicts

If you notice styling issues:

- Review the new style options in the documentation
- Update any custom styles to use the new style properties
- Check for any CSS specificity conflicts

## Need Help?

If you encounter any issues during the upgrade process:

1. Check the [GitHub issues](https://github.com/Clariity/react-chessboard/issues) for similar problems
2. Review the [documentation](https://react-chessboard.vercel.app/) for detailed information
3. Create a new issue if you can't find a solution

## Additional Resources

- [Full Documentation](https://react-chessboard.vercel.app/)
- [GitHub Repository](https://github.com/Clariity/react-chessboard)
- [Example Implementations](https://react-chessboard.vercel.app/?path=/docs/how-to-use--docs)
